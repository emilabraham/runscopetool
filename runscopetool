#!/bin/bash 
# The runscope tool
# Developed by emilabraham

#Variables
access_token=053e4c58-1f8c-48d8-8fb9-148a3638c81d
client_id=a21ebb4a-ee38-48d7-aead-44b2428f7f71
client_secret=a04102ec-e163-4d34-86ee-dfe5477b2aaf

# Retrieve the list of buckets along with their ID's and write to output.json
# The pipe to python prettifies the output
curl -H "Authorization:Bearer $access_token" https://api.runscope.com/buckets \
  | python -mjson.tool > output.json

# Declare a buckets array
buckets=()

# Fill array with output of jq. jq reads from output.json
while IFS= read -r entry; do
  buckets+=("$entry")
done < <(jq -r '.data | .[].name' output.json)

# Add exit option to the array
buckets+=(Exit)

PS3="Your choice: " #This changes the select prompt

# Create bucket selection menu
select bucket in "${buckets[@]}"; do 
  if [ $REPLY -eq 12 ];
  then
    echo "Exiting..."
    break;
  elif [ 1 -le $REPLY ] && [ $REPLY -le 11 ];
  then
    echo "You selected $bucket which is option $REPLY"
    break;
  else
    echo "Incorrect Input: Select a number 1-12"
  fi
done

# The index of the selected bucket
index=$REPLY-1

jq '.data | .['$index']' output.json > output2.json

cat output2.json

# The Bucket Key of selected Bucket.
# We need this for grabbing all the tests within that bucket
key=$(jq '.data | .['$index'] | .key' output.json)
